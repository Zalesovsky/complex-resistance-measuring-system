# complex-resistance-measuring-system 

## Описание проекта
Этот проект предназначен для измерения комплексного сопротивления четырехполюсника на основе закона Ома для переменного тока. Устройство состоит из двух основных компонентов:
1. Программа для микроконтроллера на Arduino (ARD4).
2. Приложение для Windows Forms (RelayControl2010), которое управляет микроконтроллером через COM-порт для переключения режимов измерения.

## Принцип измерения

Принцип измерения основан на законе Ома для переменного тока.

### Формула расчета комплексного сопротивления

Z_x = (U_x / I_x) * e^φ

<details><summary>Схема 1</summary>

![Z_x](image.png)

</details>


### Определение тока через шунтирующее сопротивление

I_x = U_ш / R_ш

<details><summary>Схема 2</summary>

![I_x](image-1.png)

</details>

## Схема измерительного устройства

На начальном этапе микроконтроллер ATMEGA328P формирует задающий ШИМ-сигнал, который поступает на фильтр и приобретает синусоидальный вид.

### Схема

<details><summary>Схема измерительного устройства</summary>

![Схема измерительного устройства](image-2.png)

</details>

### Трассировка платы

<details><summary>Трассировка платы</summary>

![компоновка](компоновка.jpg)
![трассировка низ](<трассировка низ.jpg>)

</details>

## Алгоритм работы

1. **Формирование сигнала**:
    - МК формирует задающий ШИМ-сигнал.
    - ШИМ-сигнал поступает на фильтр и преобразуется в синусоидальный сигнал.
    - Сигнал поступает на измеряемое комплексное сопротивление Zx, через которое подключено измерительное устройство.

<details><summary>Преобразование ШИМ-сигнала в синусоидальный</summary>

![ШИМ-1](график2.jpg) 
![ШИМ-2](график3.jpg)

</details>

2. **Измерение амплитуды**:
    - Операционные усилители U2A и U2B выполняют роль выпрямителей.
    - Сигналы с выходов усилителей поступают на АЦП МК.
    - Определяется амплитуда сигнала.

<details><summary>Определение амплитуды сигнала</summary>

![Схема 3](image-5.png)
![Амплитуда сигнала](график1.jpg)

</details>

3. **Программный медианный фильтр**:
    - Фильтр находит среди массива значений среднее значение, которое является искомым напряжением Ux.

4. **Определение фронтов сигналов**:
    - Сигналы поступают на входы компараторов U3A и U3B.
    - Компараторы выделяют фронт и спад сигналов.
    - МК фиксирует моменты времени t1, t2 и t3.

<details><summary>Определение моментов времени </summary>

![Схема 4](график5.BMP)
![Моменты времени](график6.jpg)

</details>    

5. **Расчет комплексного сопротивления**:
    - Период сигнала определяется как разность моментов времени t2 и t1.
    - Угол сдвига фазы определяется выражением: φ = 2π * ΔT / T.
    - Фазовый сдвиг ΔT определяется как разница между моментами времени t3 и t2.
    - Расчет значения комплексного сопротивления Zx.

## Управление устройством через ПК

Устройство подключается к ПК через COM-порт и управляется оператором через интерфейс. По приему команды выполняется измерение и отправляется результат на ПК.

### Формат передаваемого пакета

<details><summary>Структура пакета</summary>

![Структура пакета](схема3.BMP)

</details>  

Пакет данных имеет следующую структуру:
- 0, 11 – символы начала и конца пакета.
- 1 – ID устройства.
- 2, 3 – код выполняемой команды.
- 4 - 9 – данные.
- 10 – контрольная сумма (CRC).

## Настройка и запуск

1. Загрузите код ARD4 на ваш Arduino.
2. Подключите устройство к ПК через COM-порт.
3. Запустите приложение Windows Forms (RelayControl2010) для управления устройством.

### Приложение Windows Forms (RelayControl2010)

- Управляет микроконтроллером для переключения режимов измерения.
- Формирует пакет данных и передает его устройству.
- Обрабатывает результаты измерений и отображает их на экране.

## Требования

- Arduino (ATmega328P).
- Приложение Windows Forms для управления устройством.
- COM-порт для связи между ПК и Arduino.

---
