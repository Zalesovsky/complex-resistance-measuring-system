# complex-resistance-measuring-system 

Этот пет-проект, который был выпущен 17 марта 2020 года.

## Описание проекта
Этот проект предназначен для измерения комплексного сопротивления четырехполюсника на основе закона Ома для переменного тока. Устройство состоит из двух основных компонентов:
1. Программа для микроконтроллера на Arduino (ARD4).
2. Приложение для Windows Forms (RelayControl2010), которое управляет микроконтроллером через COM-порт для переключения режимов измерения.

## Принцип измерения

Принцип измерения основан на законе Ома для переменного тока.

### Формула расчета комплексного сопротивления

Z_x = (U_x / I_x) * e^φ

<details><summary>Схема 1</summary>

![схема1](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/9fe5ea9a-fb73-4b5b-b721-a9eef31a3681)

</details>


### Определение тока через шунтирующее сопротивление

I_x = U_ш / R_ш

<details><summary>Схема 2</summary>

![схема2](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/0c648049-fbb9-4eef-8d5f-76f903d95833)

</details>

## Схема измерительного устройства

На начальном этапе микроконтроллер ATMEGA328P формирует задающий ШИМ-сигнал, который поступает на фильтр и приобретает синусоидальный вид.

### Схема

<details><summary>Схема измерительного устройства</summary>

![схема0](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/5355cdd5-f43f-4467-8f01-8716fab9e47b)

</details>

### Трассировка платы

<details><summary>Трассировка платы</summary>

![компоновка](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/ec30c8ec-519a-4304-8cba-9b4526778050)
![трассировка низ](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/5d1879f8-7770-4f85-a55e-86f84717bb0e)

</details>

## Алгоритм работы

1. **Формирование сигнала**:
    - МК формирует задающий ШИМ-сигнал.
    - ШИМ-сигнал поступает на фильтр и преобразуется в синусоидальный сигнал.
    - Сигнал поступает на измеряемое комплексное сопротивление Zx, через которое подключено измерительное устройство.

<details><summary>Преобразование ШИМ-сигнала в синусоидальный</summary>

![график3](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/15bba517-b565-451e-9eed-5bbf0a0a5137)
![график2](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/39c1a462-149b-42a2-884d-b59f01b7fcb2)

</details>

2. **Измерение амплитуды**:
    - Операционные усилители U2A и U2B выполняют роль выпрямителей.
    - Сигналы с выходов усилителей поступают на АЦП МК.
    - Определяется амплитуда сигнала.

<details><summary>Определение амплитуды сигнала</summary>

![график4](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/a4b9ce5f-c9c2-4980-9121-492bcd6098d4)
![график1](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/0830f8d9-3a24-4fc2-8a4f-c05a04a1db47)

</details>

3. **Программный медианный фильтр**:
    - Фильтр находит среди массива значений среднее значение, которое является искомым напряжением Ux.

4. **Определение фронтов сигналов**:
    - Сигналы поступают на входы компараторов U3A и U3B.
    - Компараторы выделяют фронт и спад сигналов.
    - МК фиксирует моменты времени t1, t2 и t3.

<details><summary>Определение моментов времени </summary>
    
![график5](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/51f42c21-f772-4b2e-8537-ac942ef940b0)
![график6](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/c2a2af6c-7ef8-49ce-ac48-80222ad463c4)

</details>    

5. **Расчет комплексного сопротивления**:
    - Период сигнала определяется как разность моментов времени t2 и t1.
    - Угол сдвига фазы определяется выражением: φ = 2π * ΔT / T.
    - Фазовый сдвиг ΔT определяется как разница между моментами времени t3 и t2.
    - Расчет значения комплексного сопротивления Zx.

## Управление устройством через ПК

Устройство подключается к ПК через COM-порт и управляется оператором через интерфейс. По приему команды выполняется измерение и отправляется результат на ПК.

### Формат передаваемого пакета

<details><summary>Структура пакета</summary>

![схема3](https://github.com/Zalesovsky/complex-resistance-measuring-system/assets/49143456/d94b0d6c-1360-412e-a2a8-e73ee58ef381)

</details>  

Пакет данных имеет следующую структуру:
- 0, 11 – символы начала и конца пакета.
- 1 – ID устройства.
- 2, 3 – код выполняемой команды.
- 4 - 9 – данные.
- 10 – контрольная сумма (CRC).

## Настройка и запуск

1. Загрузите код ARD4 на ваш Arduino.
2. Подключите устройство к ПК через COM-порт.
3. Запустите приложение Windows Forms (RelayControl2010) для управления устройством.

### Приложение Windows Forms (RelayControl2010)

- Управляет микроконтроллером для переключения режимов измерения.
- Формирует пакет данных и передает его устройству.
- Обрабатывает результаты измерений и отображает их на экране.

## Требования

- Arduino (ATmega328P).
- Приложение Windows Forms для управления устройством.
- COM-порт для связи между ПК и Arduino.
